/*! ========================================================================
 * App.js v1.1.2
 * Copyright 2014 pampersdry
 * ========================================================================
 *
 * pampersdry@gmail.com
 *
 * This script will be use in my other projects too.
 * Your support ensure the continuity of this script and it projects.
 * ======================================================================== */
if (typeof jQuery === "undefined") throw new Error("This application requires jQuery");
var APP = {
    init: function() {
        $("html").Core()
    },
    sidebarSparklines: {
        init: function() {
//            $("aside .sidebar-sparklines").sparkline("html", {
//                enableTagOptions: true
//            })
        }
    },
    headerDropdown: {
        init: function(options) {
            $(options.dropdown).one("shown.bs.dropdown", coreDropdown);

            function coreDropdown(e) {
                var $target = $(e.target),
                    $mediaList = $target.find(".media-list"),
                    $indicator = $target.find(".indicator");
                $indicator.addClass("animation animating fadeInDown").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend", function() {
                    $(this).removeClass("animation animating fadeInDown")
                });
                $.ajax({
                    url: options.url,
                    cache: false,
                    type: "POST",
                    dataType: "json"
                }).done(function(data) {
                    var template = $target.find(".mustache-template").html(),
                        rendered = Mustache.render(template, data);
                    $indicator.addClass("hide");
                    $target.find(".count").html("(" + data.data.length + ")");
                    $mediaList.prepend(rendered);
                    $mediaList.find(".media.new").each(function() {
                        $(this).addClass("animation animating flipInX").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend", function() {
                            $(this).removeClass("animation animating flipInX")
                        })
                    })
                })
            }
        }
    }
};
$(function() {
    APP.init();
    APP.sidebarSparklines.init();
    APP.headerDropdown.init({
        "dropdown": "#header-dd-message",
        "url": "server/message.php"
    });
    APP.headerDropdown.init({
        "dropdown": "#header-dd-notification",
        "url": "server/notification.php"
    })
});